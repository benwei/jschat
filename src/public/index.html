<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Tahoma, Geneva, sans-serif;
      }

      div {
        display: inline;
      }
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>
      function updateStats(blob) {
	      document.getElementById('chat').innerHTML += blob.sender + ":" + blob.data + "<br>";
	      var height = $('body').height();
	      $('body').scrollTop(height);
      }

      var timer_reconnect = null;
      var retry_interval = 5;

      function start_wsserver() {
	      var host = window.document.location.host.replace(/^http:\/\//, '');
	      var ws = new WebSocket('ws://' + host);
	      ws.onmessage = function (event) {
		      if (timer_reconnect) {
			      clearInterval(timer_reconnect);
			      timer_reconnect = null;
			      updateStats({sender: 'info', data:"server connected."}); 
		      }

		      var obj;
		      try {
			      obj = JSON.parse(event.data);
		      } catch (e) {};
		      if (obj)
		      updateStats(obj);
	      };
	      ws.onerror = function (err) {
		      console.log("ws error:" + JSON.stringify(err)); 
              ws.close();
	      };
	      ws.onclose = function () {
		      if (!timer_reconnect) {
			      timer_reconnect = setInterval(function () {
				      updateStats({sender: 'info', data:"reconnecting server within " + retry_interval + " seconds."}); 
				      start_wsserver();
			      }, retry_interval * 1000);
		      }
	      };
      }

      start_wsserver();
    </script>
    <script type = "text/javascript">
	    // Define the entry point
    $(document).ready(function()
    {
	    // The DOM (document object model) is constructed
	    // We will initialize and run our plugin here
    });
    </script>
    </head>
    <body>
	    <strong>Lan Chat Server</strong><br>
	    <div id='chat'></div><br>
    </body>
			    </html>
